// Copyright (c) Microsoft Corporation.
// Licensed under the MIT license.
import { __awaiter } from "tslib";
/**
 * The programmatic identifier of the ndJsonPolicy.
 */
export const ndJsonPolicyName = "ndJsonPolicy";
/**
 * ndJsonPolicy is a policy used to control keep alive settings for every request.
 */
export function ndJsonPolicy() {
    return {
        name: ndJsonPolicyName,
        sendRequest(request, next) {
            return __awaiter(this, void 0, void 0, function* () {
                // There currently isn't a good way to bypass the serializer
                if (typeof request.body === "string" && request.body.startsWith("[")) {
                    const body = JSON.parse(request.body);
                    if (Array.isArray(body)) {
                        request.body = body.map((item) => JSON.stringify(item) + "\n").join("");
                    }
                }
                return next(request);
            });
        }
    };
}
//# sourceMappingURL=ndJsonPolicy.js.map